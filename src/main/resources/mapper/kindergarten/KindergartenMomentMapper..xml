<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cqyz.aibeijiayuan.api.kindergarten.mapper.KindergartenMomentMapper">
    <select id="getMomentList" resultType="com.cqyz.aibeijiayuan.bean.moment.vo.MomentVO">
        SELECT
        *
        FROM
        abjy_tb_moment m,
        (SELECT
        *
        FROM
        ((SELECT
        teacher_id AS user_id, teacher_name AS `author_name`
        FROM
        abjy_tb_teacher) UNION (SELECT
        parent_id AS user_id, parent_name AS `author_name`
        FROM
        abjy_tb_parent)) b) a
        WHERE
        JSON_CONTAINS(moment_publish_classes_ids, #{classId})
        AND m.moment_author_id = a.user_id
        AND (m.is_hide = 0 or m.moment_author_id =#{myId})
        AND m.is_delete = 0 and m.moment_type = 1
    </select>

    <select id="getComment" resultType="com.cqyz.aibeijiayuan.bean.comment.vo.CommentVO">
        select c.*,a.author_name from abjy_tb_comment c,
        (select * from ((SELECT teacher_id as user_id ,teacher_name as `author_name` FROM abjy_tb_teacher)
        union
        (select parent_id as user_id ,parent_name as `author_name` from abjy_tb_parent))b ) a
        where `c`.upper_id = #{id}
        and `c`.comment_author_id = a.user_id
        and (`c`.is_hide = 0 or c.comment_author_id =#{myId}) and `c`.is_delete = 0
    </select>

    <!--     <select id="getComment" resultType="com.cqyz.aibeijiayuan.bean.comment.vo.CommentVO">-->
    <!--        select c.* from abjy_tb_comment c ,abjy-->
    <!--        where c.upper_id = #{id}-->
    <!--        and c.is_hide = 0 and c.is_delete = 0-->
    <!--    </select>-->


    <select id="getLikes" resultType="java.lang.String">
        select a.* from abjy_tb_like c,
        (select * from ((SELECT teacher_id as user_id ,teacher_name as `author_name` FROM abjy_tb_teacher)
        union
        (select parent_id as user_id ,parent_name as `author_name` from abjy_tb_parent))b ) a
        where c.like_user_id = a.user_id

    </select>
</mapper>